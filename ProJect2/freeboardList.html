<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./js/jsp.js"></script>
    <!-- Bootstrap core CSS -->
    <link href="./vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="./css/heroic-features.css" rel="stylesheet">
</head>
<body>
    <header  style="text-align: center; background-color: white;">
        <h3>자유 게시판</h3>
        <div style="text-align: right;">
            <input id="id_searchText" type="text" value="">
            <input type="button"  value="검색" onclick="f_search()">
        </div>
        <p class="lead" id="id_p"></p>
        <a href="./write1.html" class="btn btn-primary btn-lg">게시물 작성</a>
      </header>
    <script>
        var v_p = document.getElementById("id_p");
        var v_pgNum = request.getParameter("pg_num");
        var v_curPage = 1; // 현재 페이지이며 디폴트 값
        if (v_pgNum) {
            v_curPage = v_pgNum;
        }

        // localStorage 내용 읽어와서 출력하기
        var v_tblName = "게시판";
        var v_arrDatas = JSON.parse(localStorage.getItem(v_tblName));
        // document.write("<h1>형편없는 게시판</h1>");

        // 페이지 나누기, 페이지당 10개, 전체 페이지 수 = 전체 글수 / 페이지당 글수
        var v_pgPGSu = 10;
        var v_totalGSu = v_arrDatas.length;
        var v_totalPG = Math.ceil(v_totalGSu / v_pgPGSu);

        var v_startNum = (v_curPage - 1) * v_pgPGSu; // 페이지별 스타트 글넘버 배열 index
        var v_endNum = v_startNum + v_pgPGSu;

        // 마지막 페이지의 마지막 글 넘버
        if (v_endNum > (v_arrDatas.length)) {
            v_endNum = v_arrDatas.length;
        }

        var v_tblStr = "<table class='table table-striped table-hover'>";
        v_tblStr += "<tr><th>글번</th><th>제목</th><th>작성자</th><th>분류</th></tr>";
        for (var i = v_startNum; i < v_endNum; i++) {
            v_tblStr += "<tr>";
            v_tblStr += "<td>" + v_arrDatas[i].num + "</td>";
            v_tblStr += "<td><a href='./read1.html?g_num=" + v_arrDatas[i].num + "'>" + v_arrDatas[i].title + "</td>";
            v_tblStr += "<td>" + v_arrDatas[i].writer + "</td>";
            v_tblStr += "<td>" + v_arrDatas[i].category + "</td>";
            v_tblStr += "</tr>";
        }
        v_tblStr += "</table>";
        
       // 사용자 페이지 클릭 모양 만들어주기
       for (var v_page = 1; v_page <= v_totalPG; v_page++) {
            if (v_page == v_curPage) {
                v_tblStr += "<a style='font-size:1.5em;color:blue' href='freeboardList.html?pg_num=" + v_page + "'>" + v_page + "</a>";
            } else {
                v_tblStr += "<a href='./freeboardList.html?pg_num=" + v_page + "'>" + v_page + "</a>";
            }
            v_tblStr += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
        }
        v_p.innerHTML = v_tblStr;

        var v_searchText = document.getElementById("id_searchText");
        function f_search(){
            var p_value = v_searchText.value;
             v_tblStr = "<table class='table table-striped table-hover'>";
                v_tblStr += "<tr><th>글번</th><th>제목</th><th>작성자</th><th>분류</th></tr>";
            for(var i=v_startNum; i<v_endNum; i++){
                if(v_arrDatas[i].title.indexOf(p_value) != -1){
                        v_tblStr += "<tr>";
                        v_tblStr += "<td>" + v_arrDatas[i].num + "</td>";
                        v_tblStr += "<td><a href='./read1.html?g_num=" + v_arrDatas[i].num + "'>" + v_arrDatas[i].title + "</td>";
                        v_tblStr += "<td>" + v_arrDatas[i].writer + "</td>";
                        v_tblStr += "<td>" + v_arrDatas[i].category + "</td>";
                        v_tblStr += "<tr>"             
                }
            }
            v_tblStr += "</table>";
            for (var v_page = 1; v_page <= v_totalPG; v_page++) {
            if (v_page == v_curPage) {
                v_tblStr += "<a style='font-size:1.5em;color:blue' href='freeboardList.html?pg_num=" + v_page + "'>" + v_page + "</a>";
            } else {
                v_tblStr += "<a href='./freeboardList.html?pg_num=" + v_page + "'>" + v_page + "</a>";
            }
            v_tblStr += "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"
            }
            v_p.innerHTML = v_tblStr;
        }
       
    </script>
</body>

</html>